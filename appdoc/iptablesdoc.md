# iptables基础知识及示例

这里以纯净系统centos7为例，其它系统一样的环境，软件，只是可能使用方法不同，自行谷歌百度。



## iptables安装及使用方法

这里只介绍跟DNS解锁相关的，其它自行搜索，防火墙与其它防火墙不能共存，自行检查是否有其它，有则需要停止并开机禁用

```
yum install iptables-services -y //安装iptables
//常用命令
systemctl status iptables  #状态
systemctl start iptables  #启动
systemctl stop iptables  #禁用
systemctl restart iptables  #重启
systemctl enable iptables  #开机启动
systemctl disable iptables  #开机禁用
service iptables save  #保存规则

#安装后默认规则为
# Generated by iptables-save v1.4.21 on Thu Sep 16 13:00:42 2021
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [262:38242]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
# Completed on Thu Sep 16 13:00:42 2021

#下列命令中4代表插入第四行，原行下移，22端口在第四行，注意顺序不要乱，顺序为优先级
iptables -I INPUT 4 -p tcp -m tcp --dport 8080 -j ACCEPT #开启8080 tcp端口
iptables -I INPUT 4 -p udp -m udp --dport 8080 -j ACCEPT  #开启8080 udp端口

iptables -L -n --line-number  #显示规则和相对应的编号
iptables -D INPUT 4  #删除编号4得规则

#劫持出网端口53的所有UDP流量到 注意内循环
iptables -t nat -A OUTPUT -p udp -m udp --dport 53 -j DNAT --to-destination 127.0.0.1


```



